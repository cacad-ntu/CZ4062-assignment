root@ntu:/home/user1/vbox# magick input.psb null
Aborted (core dumped)

root@ntu:/home/user1/vbox# coredumpctl dump
           PID: 2835 (magick)
           UID: 0 (root)
           GID: 0 (root)
        Signal: 6 (ABRT)
     Timestamp: Tue 2017-11-14 23:00:07 SGT (2min 6s ago)
  Command Line: magick input.psb null
    Executable: /usr/local/bin/magick
 Control Group: /user.slice/user-1000.slice/session-c1.scope
          Unit: session-c1.scope
         Slice: user-1000.slice
       Session: c1
     Owner UID: 1000 (user1)
       Boot ID: 8c243f30a8bb4bc7a4b2e3f0c595ddf5
    Machine ID: da5c422f7b5c4c698ea4ecba7961801c
      Hostname: ntu
      Coredump: /var/lib/systemd/coredump/core.magick.0.8c243f30a8bb4bc7a4b2e3f0c595ddf5.2835.1510671607000000000000.xz
       Message: Process 2835 (magick) of user 0 dumped core.
                
                Stack trace of thread 2835:
                #0  0x00007f0c51043428 __GI_raise (libc.so.6)
                #1  0x00007f0c5104502a __GI_abort (libc.so.6)
                #2  0x00007f0c51a0c3e8 MagickSignalHandler (libMagickCore-7.Q16HDRI.so.1)
                #3  0x00007f0c513e9390 __restore_rt (libpthread.so.0)
                #4  0x00007f0c51043428 __GI_raise (libc.so.6)
                #5  0x00007f0c5104502a __GI_abort (libc.so.6)
                #6  0x00007f0c51a0c3e8 MagickSignalHandler (libMagickCore-7.Q16HDRI.so.1)
                #7  0x00007f0c513e9390 __restore_rt (libpthread.so.0)
                #8  0x00007f0c5107c71a __GI__IO_fwrite (libc.so.6)
                #9  0x00007f0c51b2d027 WritePSDChannel (libMagickCore-7.Q16HDRI.so.1)
                #10 0x00007f0c51b2ee8b WritePSDChannels (libMagickCore-7.Q16HDRI.so.1)
                #11 0x00007f0c51b3037b WritePSDImage (libMagickCore-7.Q16HDRI.so.1)
                #12 0x00007f0c5198cbc6 WriteImage (libMagickCore-7.Q16HDRI.so.1)
                #13 0x00007f0c5198d494 WriteImages (libMagickCore-7.Q16HDRI.so.1)
                #14 0x00007f0c516c23fe CLINoImageOperator (libMagickWand-7.Q16HDRI.so.0)
                #15 0x00007f0c516c3149 CLIOption (libMagickWand-7.Q16HDRI.so.0)
                #16 0x00007f0c5165ad14 ProcessCommandOptions (libMagickWand-7.Q16HDRI.so.0)
                #17 0x00007f0c5165b49f MagickImageCommand (libMagickWand-7.Q16HDRI.so.0)
                #18 0x00007f0c51675898 MagickCommandGenesis (libMagickWand-7.Q16HDRI.so.0)
                #19 0x000000000040121b MagickMain (magick)
                #20 0x00007f0c5102e830 __libc_start_main (libc.so.6)
                #21 0x0000000000400ff9 _start (magick)

root@ntu:/home/user1/vbox# valgrind magick input.psb null
==5077== Memcheck, a memory error detector
==5077== Copyright (C) 2002-2015, and GNU GPL'd, by Julian Seward et al.
==5077== Using Valgrind-3.11.0 and LibVEX; rerun with -h for copyright info
==5077== Command: magick input.psb null
==5077== 
==5077== Syscall param read(buf) points to unaddressable byte(s)
==5077==    at 0x59FB230: __read_nocancel (syscall-template.S:84)
==5077==    by 0x597CF78: _IO_file_xsgetn (fileops.c:1434)
==5077==    by 0x5972235: fread (iofread.c:38)
==5077==    by 0x5070853: ReadPSDLayers (psd.c:1697)
==5077==    by 0x5071BCD: ReadPSDImage (psd.c:2113)
==5077==    by 0x4ECA77C: ReadImage (constitute.c:555)
==5077==    by 0x4ECB6CE: ReadImages (constitute.c:852)
==5077==    by 0x54AE221: CLINoImageOperator (operation.c:4743)
==5077==    by 0x54AF148: CLIOption (operation.c:5238)
==5077==    by 0x5446A7C: ProcessCommandOptions (magick-cli.c:421)
==5077==    by 0x544749E: MagickImageCommand (magick-cli.c:791)
==5077==    by 0x5461897: MagickCommandGenesis (mogrify.c:183)
==5077==  Address 0x66f2938 is 0 bytes after a block of size 1,288 alloc'd
==5077==    at 0x4C2DB8F: malloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==5077==    by 0x506FFA2: ReadPSDLayers (psd.c:1539)
==5077==    by 0x5071BCD: ReadPSDImage (psd.c:2113)
==5077==    by 0x4ECA77C: ReadImage (constitute.c:555)
==5077==    by 0x4ECB6CE: ReadImages (constitute.c:852)
==5077==    by 0x54AE221: CLINoImageOperator (operation.c:4743)
==5077==    by 0x54AF148: CLIOption (operation.c:5238)
==5077==    by 0x5446A7C: ProcessCommandOptions (magick-cli.c:421)
==5077==    by 0x544749E: MagickImageCommand (magick-cli.c:791)
==5077==    by 0x5461897: MagickCommandGenesis (mogrify.c:183)
==5077==    by 0x40121A: MagickMain (magick.c:149)
==5077==    by 0x592482F: (below main) (libc-start.c:291)
==5077== 
==5077== Invalid write of size 1
==5077==    at 0x4F98F69: PopQuantumPixel (quantum-export.c:196)
==5077==    by 0x4F98F69: ExportRedQuantum (quantum-export.c:3069)
==5077==    by 0x4F98F69: ExportQuantumPixels (quantum-export.c:4045)
==5077==    by 0x506BFE8: WritePSDChannel (psd.c:2545)
==5077==    by 0x506DE8A: WritePSDChannels (psd.c:2683)
==5077==    by 0x506F37A: WritePSDImage (psd.c:3359)
==5077==    by 0x4ECBBC5: WriteImage (constitute.c:1101)
==5077==    by 0x4ECC493: WriteImages (constitute.c:1320)
==5077==    by 0x54AE3FD: CLINoImageOperator (operation.c:4778)
==5077==    by 0x54AF148: CLIOption (operation.c:5238)
==5077==    by 0x5446D13: ProcessCommandOptions (magick-cli.c:526)
==5077==    by 0x544749E: MagickImageCommand (magick-cli.c:791)
==5077==    by 0x5461897: MagickCommandGenesis (mogrify.c:183)
==5077==    by 0x40121A: MagickMain (magick.c:149)
==5077==  Address 0x697ae1f is 0 bytes after a block of size 511 alloc'd
==5077==    at 0x4C2DB8F: malloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==5077==    by 0x4F875C1: AcquireQuantumPixels (quantum.c:175)
==5077==    by 0x4F875C1: SetQuantumDepth (quantum.c:693)
==5077==    by 0x4F877D6: AcquireQuantumInfo (quantum.c:125)
==5077==    by 0x506BF71: WritePSDChannel (psd.c:2514)
==5077==    by 0x506DE8A: WritePSDChannels (psd.c:2683)
==5077==    by 0x506F37A: WritePSDImage (psd.c:3359)
==5077==    by 0x4ECBBC5: WriteImage (constitute.c:1101)
==5077==    by 0x4ECC493: WriteImages (constitute.c:1320)
==5077==    by 0x54AE3FD: CLINoImageOperator (operation.c:4778)
==5077==    by 0x54AF148: CLIOption (operation.c:5238)
==5077==    by 0x5446D13: ProcessCommandOptions (magick-cli.c:526)
==5077==    by 0x544749E: MagickImageCommand (magick-cli.c:791)
==5077== 
==5077== Invalid read of size 1
==5077==    at 0x4F98F30: PopQuantumPixel (quantum-export.c:198)
==5077==    by 0x4F98F30: ExportRedQuantum (quantum-export.c:3069)
==5077==    by 0x4F98F30: ExportQuantumPixels (quantum-export.c:4045)
==5077==    by 0x506BFE8: WritePSDChannel (psd.c:2545)
==5077==    by 0x506DE8A: WritePSDChannels (psd.c:2683)
==5077==    by 0x506F37A: WritePSDImage (psd.c:3359)
==5077==    by 0x4ECBBC5: WriteImage (constitute.c:1101)
==5077==    by 0x4ECC493: WriteImages (constitute.c:1320)
==5077==    by 0x54AE3FD: CLINoImageOperator (operation.c:4778)
==5077==    by 0x54AF148: CLIOption (operation.c:5238)
==5077==    by 0x5446D13: ProcessCommandOptions (magick-cli.c:526)
==5077==    by 0x544749E: MagickImageCommand (magick-cli.c:791)
==5077==    by 0x5461897: MagickCommandGenesis (mogrify.c:183)
==5077==    by 0x40121A: MagickMain (magick.c:149)
==5077==  Address 0x697ae1f is 0 bytes after a block of size 511 alloc'd
==5077==    at 0x4C2DB8F: malloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==5077==    by 0x4F875C1: AcquireQuantumPixels (quantum.c:175)
==5077==    by 0x4F875C1: SetQuantumDepth (quantum.c:693)
==5077==    by 0x4F877D6: AcquireQuantumInfo (quantum.c:125)
==5077==    by 0x506BF71: WritePSDChannel (psd.c:2514)
==5077==    by 0x506DE8A: WritePSDChannels (psd.c:2683)
==5077==    by 0x506F37A: WritePSDImage (psd.c:3359)
==5077==    by 0x4ECBBC5: WriteImage (constitute.c:1101)
==5077==    by 0x4ECC493: WriteImages (constitute.c:1320)
==5077==    by 0x54AE3FD: CLINoImageOperator (operation.c:4778)
==5077==    by 0x54AF148: CLIOption (operation.c:5238)
==5077==    by 0x5446D13: ProcessCommandOptions (magick-cli.c:526)
==5077==    by 0x544749E: MagickImageCommand (magick-cli.c:791)
==5077== 
==5077== Invalid read of size 1
==5077==    at 0x506C011: WritePSDChannel (psd.c:2548)
==5077==    by 0x506DE8A: WritePSDChannels (psd.c:2683)
==5077==    by 0x506F37A: WritePSDImage (psd.c:3359)
==5077==    by 0x4ECBBC5: WriteImage (constitute.c:1101)
==5077==    by 0x4ECC493: WriteImages (constitute.c:1320)
==5077==    by 0x54AE3FD: CLINoImageOperator (operation.c:4778)
==5077==    by 0x54AF148: CLIOption (operation.c:5238)
==5077==    by 0x5446D13: ProcessCommandOptions (magick-cli.c:526)
==5077==    by 0x544749E: MagickImageCommand (magick-cli.c:791)
==5077==    by 0x5461897: MagickCommandGenesis (mogrify.c:183)
==5077==    by 0x40121A: MagickMain (magick.c:149)
==5077==    by 0x592482F: (below main) (libc-start.c:291)
==5077==  Address 0x697ae1f is 0 bytes after a block of size 511 alloc'd
==5077==    at 0x4C2DB8F: malloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==5077==    by 0x4F875C1: AcquireQuantumPixels (quantum.c:175)
==5077==    by 0x4F875C1: SetQuantumDepth (quantum.c:693)
==5077==    by 0x4F877D6: AcquireQuantumInfo (quantum.c:125)
==5077==    by 0x506BF71: WritePSDChannel (psd.c:2514)
==5077==    by 0x506DE8A: WritePSDChannels (psd.c:2683)
==5077==    by 0x506F37A: WritePSDImage (psd.c:3359)
==5077==    by 0x4ECBBC5: WriteImage (constitute.c:1101)
==5077==    by 0x4ECC493: WriteImages (constitute.c:1320)
==5077==    by 0x54AE3FD: CLINoImageOperator (operation.c:4778)
==5077==    by 0x54AF148: CLIOption (operation.c:5238)
==5077==    by 0x5446D13: ProcessCommandOptions (magick-cli.c:526)
==5077==    by 0x544749E: MagickImageCommand (magick-cli.c:791)
==5077== 
==5077== Invalid read of size 1
==5077==    at 0x506C008: WritePSDChannel (psd.c:2549)
==5077==    by 0x506DE8A: WritePSDChannels (psd.c:2683)
==5077==    by 0x506F37A: WritePSDImage (psd.c:3359)
==5077==    by 0x4ECBBC5: WriteImage (constitute.c:1101)
==5077==    by 0x4ECC493: WriteImages (constitute.c:1320)
==5077==    by 0x54AE3FD: CLINoImageOperator (operation.c:4778)
==5077==    by 0x54AF148: CLIOption (operation.c:5238)
==5077==    by 0x5446D13: ProcessCommandOptions (magick-cli.c:526)
==5077==    by 0x544749E: MagickImageCommand (magick-cli.c:791)
==5077==    by 0x5461897: MagickCommandGenesis (mogrify.c:183)
==5077==    by 0x40121A: MagickMain (magick.c:149)
==5077==    by 0x592482F: (below main) (libc-start.c:291)
==5077==  Address 0x697ae21 is 2 bytes after a block of size 511 alloc'd
==5077==    at 0x4C2DB8F: malloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==5077==    by 0x4F875C1: AcquireQuantumPixels (quantum.c:175)
==5077==    by 0x4F875C1: SetQuantumDepth (quantum.c:693)
==5077==    by 0x4F877D6: AcquireQuantumInfo (quantum.c:125)
==5077==    by 0x506BF71: WritePSDChannel (psd.c:2514)
==5077==    by 0x506DE8A: WritePSDChannels (psd.c:2683)
==5077==    by 0x506F37A: WritePSDImage (psd.c:3359)
==5077==    by 0x4ECBBC5: WriteImage (constitute.c:1101)
==5077==    by 0x4ECC493: WriteImages (constitute.c:1320)
==5077==    by 0x54AE3FD: CLINoImageOperator (operation.c:4778)
==5077==    by 0x54AF148: CLIOption (operation.c:5238)
==5077==    by 0x5446D13: ProcessCommandOptions (magick-cli.c:526)
==5077==    by 0x544749E: MagickImageCommand (magick-cli.c:791)
==5077== 
==5077== Invalid read of size 1
==5077==    at 0x4C35078: __GI_mempcpy (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==5077==    by 0x597D241: _IO_file_xsputn@@GLIBC_2.2.5 (fileops.c:1319)
==5077==    by 0x59727BA: fwrite (iofwrite.c:39)
==5077==    by 0x506C026: WritePSDChannel (psd.c:2576)
==5077==    by 0x506DE8A: WritePSDChannels (psd.c:2683)
==5077==    by 0x506F37A: WritePSDImage (psd.c:3359)
==5077==    by 0x4ECBBC5: WriteImage (constitute.c:1101)
==5077==    by 0x4ECC493: WriteImages (constitute.c:1320)
==5077==    by 0x54AE3FD: CLINoImageOperator (operation.c:4778)
==5077==    by 0x54AF148: CLIOption (operation.c:5238)
==5077==    by 0x5446D13: ProcessCommandOptions (magick-cli.c:526)
==5077==    by 0x544749E: MagickImageCommand (magick-cli.c:791)
==5077==  Address 0x697ae1f is 0 bytes after a block of size 511 alloc'd
==5077==    at 0x4C2DB8F: malloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==5077==    by 0x4F875C1: AcquireQuantumPixels (quantum.c:175)
==5077==    by 0x4F875C1: SetQuantumDepth (quantum.c:693)
==5077==    by 0x4F877D6: AcquireQuantumInfo (quantum.c:125)
==5077==    by 0x506BF71: WritePSDChannel (psd.c:2514)
==5077==    by 0x506DE8A: WritePSDChannels (psd.c:2683)
==5077==    by 0x506F37A: WritePSDImage (psd.c:3359)
==5077==    by 0x4ECBBC5: WriteImage (constitute.c:1101)
==5077==    by 0x4ECC493: WriteImages (constitute.c:1320)
==5077==    by 0x54AE3FD: CLINoImageOperator (operation.c:4778)
==5077==    by 0x54AF148: CLIOption (operation.c:5238)
==5077==    by 0x5446D13: ProcessCommandOptions (magick-cli.c:526)
==5077==    by 0x544749E: MagickImageCommand (magick-cli.c:791)
==5077== 
==5077== Invalid read of size 1
==5077==    at 0x4C35086: __GI_mempcpy (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==5077==    by 0x597D241: _IO_file_xsputn@@GLIBC_2.2.5 (fileops.c:1319)
==5077==    by 0x59727BA: fwrite (iofwrite.c:39)
==5077==    by 0x506C026: WritePSDChannel (psd.c:2576)
==5077==    by 0x506DE8A: WritePSDChannels (psd.c:2683)
==5077==    by 0x506F37A: WritePSDImage (psd.c:3359)
==5077==    by 0x4ECBBC5: WriteImage (constitute.c:1101)
==5077==    by 0x4ECC493: WriteImages (constitute.c:1320)
==5077==    by 0x54AE3FD: CLINoImageOperator (operation.c:4778)
==5077==    by 0x54AF148: CLIOption (operation.c:5238)
==5077==    by 0x5446D13: ProcessCommandOptions (magick-cli.c:526)
==5077==    by 0x544749E: MagickImageCommand (magick-cli.c:791)
==5077==  Address 0x697ae20 is 1 bytes after a block of size 511 alloc'd
==5077==    at 0x4C2DB8F: malloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==5077==    by 0x4F875C1: AcquireQuantumPixels (quantum.c:175)
==5077==    by 0x4F875C1: SetQuantumDepth (quantum.c:693)
==5077==    by 0x4F877D6: AcquireQuantumInfo (quantum.c:125)
==5077==    by 0x506BF71: WritePSDChannel (psd.c:2514)
==5077==    by 0x506DE8A: WritePSDChannels (psd.c:2683)
==5077==    by 0x506F37A: WritePSDImage (psd.c:3359)
==5077==    by 0x4ECBBC5: WriteImage (constitute.c:1101)
==5077==    by 0x4ECC493: WriteImages (constitute.c:1320)
==5077==    by 0x54AE3FD: CLINoImageOperator (operation.c:4778)
==5077==    by 0x54AF148: CLIOption (operation.c:5238)
==5077==    by 0x5446D13: ProcessCommandOptions (magick-cli.c:526)
==5077==    by 0x544749E: MagickImageCommand (magick-cli.c:791)
==5077== 

valgrind: m_mallocfree.c:303 (get_bszB_as_is): Assertion 'bszB_lo == bszB_hi' failed.
valgrind: Heap block lo/hi size mismatch: lo = 576, hi = 0.
This is probably caused by your program erroneously writing past the
end of a heap block and corrupting heap metadata.  If you fix any
invalid writes reported by Memcheck, this assertion failure will
probably go away.  Please try that before reporting this as a bug.


host stacktrace:
==5077==    at 0x38083F48: ??? (in /usr/lib/valgrind/memcheck-amd64-linux)
==5077==    by 0x38084064: ??? (in /usr/lib/valgrind/memcheck-amd64-linux)
==5077==    by 0x380841F1: ??? (in /usr/lib/valgrind/memcheck-amd64-linux)
==5077==    by 0x38091A9C: ??? (in /usr/lib/valgrind/memcheck-amd64-linux)
==5077==    by 0x3807D673: ??? (in /usr/lib/valgrind/memcheck-amd64-linux)
==5077==    by 0x3807BEA3: ??? (in /usr/lib/valgrind/memcheck-amd64-linux)
==5077==    by 0x380800DA: ??? (in /usr/lib/valgrind/memcheck-amd64-linux)
==5077==    by 0x3807B6C2: ??? (in /usr/lib/valgrind/memcheck-amd64-linux)
==5077==    by 0x3805A8D0: ??? (in /usr/lib/valgrind/memcheck-amd64-linux)
==5077==    by 0x380D6234: ??? (in /usr/lib/valgrind/memcheck-amd64-linux)
==5077==    by 0x380D2D2A: ??? (in /usr/lib/valgrind/memcheck-amd64-linux)
==5077==    by 0x380D43DE: ??? (in /usr/lib/valgrind/memcheck-amd64-linux)
==5077==    by 0x380E3946: ??? (in /usr/lib/valgrind/memcheck-amd64-linux)

sched status:
  running_tid=1

Thread 1: status = VgTs_Runnable (lwpid 5077)
==5077==    at 0x59FB2AD: ??? (syscall-template.S:84)
==5077==    by 0x597CBFE: _IO_file_write@@GLIBC_2.2.5 (fileops.c:1263)
==5077==    by 0x597D389: new_do_write (fileops.c:518)
==5077==    by 0x597D389: _IO_file_xsputn@@GLIBC_2.2.5 (fileops.c:1342)
==5077==    by 0x59727BA: fwrite (iofwrite.c:39)
==5077==    by 0x506C026: WritePSDChannel (psd.c:2576)
==5077==    by 0x506DE8A: WritePSDChannels (psd.c:2683)
==5077==    by 0x506F37A: WritePSDImage (psd.c:3359)
==5077==    by 0x4ECBBC5: WriteImage (constitute.c:1101)
==5077==    by 0x4ECC493: WriteImages (constitute.c:1320)
==5077==    by 0x54AE3FD: CLINoImageOperator (operation.c:4778)
==5077==    by 0x54AF148: CLIOption (operation.c:5238)
==5077==    by 0x5446D13: ProcessCommandOptions (magick-cli.c:526)
==5077==    by 0x544749E: MagickImageCommand (magick-cli.c:791)
==5077==    by 0x5461897: MagickCommandGenesis (mogrify.c:183)
==5077==    by 0x40121A: MagickMain (magick.c:149)
==5077==    by 0x592482F: (below main) (libc-start.c:291)

Thread 2: status = VgTs_WaitSys (lwpid 5078)
==5077==    at 0x5FE8B4F: ??? (in /usr/lib/x86_64-linux-gnu/libgomp.so.1.0.0)
==5077==    by 0x5FE6417: ??? (in /usr/lib/x86_64-linux-gnu/libgomp.so.1.0.0)
==5077==    by 0x56EE6B9: start_thread (pthread_create.c:333)
==5077==    by 0x5A0B3DC: clone (clone.S:109)
